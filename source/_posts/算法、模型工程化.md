---
title: 算法、模型工程化
tags: algorithm or model engineering
---

# 概念
首先，大家先对齐下概念，避免因理解不一致，而带来的各种看不懂
## 算法
大学中所学的数据结构课本上说：算法是指解决问题或执行任务的有序步骤集合。当然，如此描述的算法，相当准确。但是，对于实际工程落地而言，还是过于：抽象 + 空。这里面描述的算法，是指：算法同学所交付的可执行文件 or so库，例如：视频压缩领域的：264算法，交付的产品：集成到ffmepg中的libx264。例如：如下命令，是使用：libx264算法真正去压缩一个视频的命令，那么：对于实际工程落地而言，所提供的带上libx264的ffmpeg可执行程序，可以简单地理解成：算法
```
ffmpeg -i source.mov -s 1280x720 -profile:v high444 -c:v libx264 -preset veryslow -crf 30 -r 30 -g 120 -keyint_min 30 -sc_threshold 40 -bf 3 -b_strategy 2 -refs 5 -c:a libfdk_aac -profile:a aac_low -b:a 128k -movflags faststart -max_muxing_queue_size 9999 -f mp4 -loglevel error 720_3.mp4 -y
```
## 模型
在计算机科学和机器学习领域，模型是对现实世界问题或系统的一种简化或抽象。如此描述模型，如同算法一样，相当准确，可惜：对于实际工程落地而言，还是：过于：抽象 + 空。因此，站在实际工程落地而言，所谓模型：其实是指：模型技术人员，已经训练好的，可以提供部署的文件zip包。

## 工程化
基于此，所谓算法、模型工程化，就是：将算法、模型技术人员，交付过来的东西（可执行文件 or so库 or zip包 or docker镜像等等），在cpu机器 or gpu机器部署起来，提供一个http接口，服务于业务。

# 需求提炼
在实际项目中，算法、模型要能标准化部署起来，并服务于实际业务，应该满足以下条件：

1、标准化部署
算法、模型，的入参、出参，千变万化，但是，期望在部署它们时，能够有一个标准化姿势，以减轻算法、模型的部署成本。

2、成本最低
部署在cpu or gpu上时，期望所花费的成本最低。
a、能够以最快的速度加载模型，避免成本的浪费
b、当流量低时，能够自动回收闲置的CPU、GPU资源
c、多个模型，流量切换时，能够自动释放资源，自动扩容资源

3、调参
 算法、模型部署好后，期望能够快速知道它的处理效果如何，输入一批预先设定好的图片、视频 + 相关参数，能够快速得到结果，并且及时反馈：当前算法、模型是否ok

4、版本迭代
算法、模型版本迭代时，能够快速训练，出结果，验证通过后，能够快速发布

## 下载
对于图片、视频而言，业务方传送过来的一般是：各种各样的url地址，如何基于这些url地址，以快速且以最低的成本下载到本地磁盘？
1、分片下载？form表单下载？
2、公网域名如何转为内网域名下载？公网域名所带来的cdn成本很贵，而一般内网域名下载，不需要钱。
3、有些算法，并不需要下载整个视频 or 整个图片，下载一段视频即可触发cpu计算，获取结果，例如：计算视频的meta信息
4、有些url有鉴权参数 + 有限期限制，如何将过期的url，重新算成有效？
5、多云部署，单元化下载，能够节省非常多的成本

## 上传
经过算法、模型的计算后，一般会产生：新的图片s or 视频s，如何将结果，快速切最低成本上传到小文件存储系统里（例如：阿里云的oss）
1、分片上传？form表单上传？
2、多云自动切换？
3、如何自动产生不冲突的文件名称？
4、成本怎么管控？

## 算法、模型如何分发
有些算法、模型巨大，集群分发时，部署有点慢，如何预热加速？

## 问题分析

当业务方反馈问题，如何快速找到算法、模型的入参 + 出参？协助相关技术人员分析问题。

## 更新迭代

分析并解决完问题后，如何快速部署新的版本到线上，需设计一套更新迭代机制，快速服务于业务方？

## 多版本管理
类似git，但是，又跟git有点不一样。线上部署的版本，最好多版本记录下，方便回滚

# 业界方案
faas：提出一个抽象的概念：function as a service，通过函数，对算法、模型，再次包装。
当然了，也可以提：aaas，算法 as a service or maas：模型 as a service，无论叫啥名字，它们的本质是一样的





