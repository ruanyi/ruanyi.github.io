---
title: 任务编排
abbrlink: 394f6975
date: 2024-02-27 21:10:21
tags:
---

# 背景

在实际应用中，业务逻辑往往涉及多个步骤和模块，需要协同工作才能完成整体任务。而任务编排通过将多个函数组织成有序的执行流程，使得开发者能够更自然地表达和管理复杂的业务逻辑。这种能力，业界称之为：工作流（Serverless
Workflow）。举些例子：

## 切片加速流程图

![](/images/slice_dag_1.png)

## 转码流程图

![](/images/tc_dag_2.png)

# 架构设计

设计一款满足：云处理场景下的工作流引擎，包括以下模块：todo 架构图

## dag

## 节点

 节点类型   | 作用                       | 功能说明 | 备注 |
--------|--------------------------|------|----|
 开始节点   | 执行dag引擎的开始动作             |      |    | 
 结束节点   | 执行dag引擎后的结束动作            |      |    |
 路由节点   | 上一个节点执行完后，根据一定的路由执行下一个节点 |      |    |
 同步处理节点 |                          |      |    |
 异步处理节点 |                          |      |    |
 并行节点   |                          |      |    |
 回调节点   |                          |      |    |
 脚本节点   |                          |      |    |

## 执行引擎

## 任务追踪

 名词      | 解释 | 关系                            | 说明                    | 备注                                   |
---------|----|-------------------------------|-----------------------|--------------------------------------|
 task    | 任务 | 一次请求，对应一笔任务                   | 一笔切片请求，对应一笔任务         | 可使用UUID生成唯一的：task_id                 |
 event   | 事件 | task 与event 是一对多的关系           | 一个dag节点，对应一个事件        | event_id = task_id + "_" + node_name |
 segment | 片  | event 与 segment 是一对多的关系       | 一个视频片，对应一个event       | segment_id = event_id + "_" + order  |
 trace   | 跟踪 | trace 与 event、segment 是一对多的关系 | 一次cpu、gpu计算，对应一次trace | 可使用UUID生成唯一的：trace_id                |

## dag剪枝

# 相关痛点